<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Store: Getting and Listening</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.2.0/redux.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/react-redux@8.0.1/dist/react-redux.min.js"></script>
    <script src='https://unpkg.com/babel-standalone@6.15.0/babel.min.js'></script>
   <script src="app.js" defer></script> 
</head>
<body>
    <div id="app"></div>
    <script type="text/babel">
        function List(props){
            const { items, removeItem, toggleItem } = props

            return <ul>
                {items.map((item =>
                {
                    return (
                    <li key={item.id}>
                        <span 
                            style={{ 
                                textDecoration: item.complete ? "line-through" : "none", 
                                color: item.complete ? "green": "red" 
                            }} 
                            {
                            ...(removeItem && { onClick:() => toggleItem(item)  }) 
                            }
                        >
                            {item.todoName||item.goalName}
                        </span>
                        {removeItem && <button onClick={() => removeItem(item)}>X</button>}
                    </li>
                )}))}
            </ul>
        }

        function Todos(props) {

            const { todos } = ReactRedux.useSelector((state) => state )
            const dispatch = ReactRedux.useDispatch()

            const inputRef = React.useRef(null);
            const addTodo = (e) => {
                e.preventDefault();
                const newTodo = inputRef.current.value
                inputRef.current.value = '';

                dispatch(createTodo({
                    id: generateID(),
                    todoName:  newTodo,
                    done: false
                }))
            }

            return (
                <div>
                    <h1>Todos</h1>
                    <input ref={inputRef} placeholder="Add a todo" />
                    <button type="button" onClick={addTodo}>Click Me!</button>
                    <List items={todos}/>
                </div>
            );
        }
        function Goals() {

            const { goals } = ReactRedux.useSelector((state) => state )
            const dispatch = ReactRedux.useDispatch()

            const inputRef = React.useRef(null);
            const addGoal = (e) => {
                e.preventDefault();

                const newGoal = inputRef.current.value
                inputRef.current.value = '';

                dispatch(createGoal({
                    id: generateID(),
                    goalName:  newGoal,
                    done: false
                }))
            }

            const handleRemoveItem = React.useCallback((item) => {

             dispatch(removeGoal(item.id))
            },[dispatch])

            const handleToggleItem = React.useCallback((item) => {

                dispatch(toggleGoal(item.id))
            },[dispatch])

            return (
                <div>
                    <h1>Goals</h1>
                    <input ref={ref => inputRef.current = ref} placeholder="Add a goal" />
                    <button type="button" onClick={addGoal}>Click Me!</button>
                    <List items={goals} removeItem={handleRemoveItem} toggleItem={handleToggleItem}/>
                </div>
            );
        }
        function App() {

            return (
                <div>
                    <Todos  />
                    <Goals />
                    <hr />
                </div>
            );
        }

        const Context = React.createContext() //

        ReactDOM.render(<ReactRedux.Provider store={store}><App  /></ReactRedux.Provider>, document.querySelector('#app'));

        function Provider({ children, store }){
            return <Context.Provider value={store}>
                {children}
            </Context.Provider>
        }

        //custom Hook
        function useDispatch(){
            const store = React.useContext(Context)
            return store.dispatch
        }

        //custom Hook
        function useSelector(mapStateToProps){
            const store =  React.useContext(Context)
            const [state, setState] = React.useState(store.getState())

            React.useEffect(() => {
                
                store.subscribe(() => {
                    setState(store.getState())
                })
                return () => {
                    store.unsubscribe();
                }
            }, [])

            return mapStateToProps(state)
        }



 /*       function UnderstandingReactContext(){
            const name = "Chidi"

            return <Context.Provider value={{
                name,
                calll: () => { console.log("heeeeee") }
            }}>
                <Parent />
            </Context.Provider>
            
        }

        function Parent(){
            return (
                <div>
                    <h1>Parent</h1>
                    <Child  />
                </div>
            )
        }

        function Child(){
            return (
                <div>
                    <h1>Child</h1>
                    <GrandChild  />
                </div>
            )
        }

        function GrandChild(){
            const value = React.useContext(Context)
            //console.log(value.calll())
            return (
                <div>
                    <h1>GrandChild</h1>
                    <h3>name: {value.name}</h3>
                </div>
            )
        }*/

 
    </script>
</body>
</html>